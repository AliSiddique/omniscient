
{% extends "base.html" %}
{% load tailwind_filters %}
{% load crispy_forms_tags %}
{% block content %}


 <div>
<div class="mx-40 mt-5">
  <h1 class="font-semibold text-lg">{{post.category}}</h1> 
<h1 class="font-semibold text-lg mb-6">{{post.title|title}}</h1>
  <img class="object-cover 	rounded-md" src="{{post.image.url}}" />
  <div class="flex justify-between mt-6">
    <div>
      <p class="font-bold text-lg"><a class="flex gap-5" href="{% url 'single-profile' post.writer.slug%}">By :<img class="rounded-full h-10" src="{{post.writer.image.url}}"/> {{post.writer|title}}</a></p>
      <small>Posted {{post.created_date|timesince}} ago</small>
    </div>
    
    <div>
      {% if fav%}
      <a href="{% url 'favourite_add' post.slug %}" class="p-2 bg-sky-600	 rounded-lg text-white font-vold">Unsave</a>
      {% else %}
      <a href="{% url 'favourite_add' post.slug %}" class="p-2 bg-sky-600	 rounded-lg text-white font-vold">Save</a>
      {%endif%}
    </div>
  </div>
  <hr class="mt-4"/>
  <p class="mx-5 px-20 mt-7 mb-20 leading-10	text-2xl font-medium">{{post.description|safe}}</p>





<div class=""> 
  <form method="POST" action="" id="friend_form">
       {% csrf_token %}
       {{form|crispy}}
      <button class="text-white rounded-lg hover:opacity-70 transition duration-3000  font-bold bg-sky-600	  p-3 " type="submit">Comment</button>
      </form>
  </div>
  <small>  {{ post.comments.all|length}} comments  </small>

  {% for post in post.comments.all %}
  <div>
    <div class="flex mb-4 mt-4">
      {% if post.profile.is_writer %}
      <a href="{% url 'single-profile' post.profile.slug %}">
        <img src="{{post.profile.image.url}}" class="rounded-full h-10"/>
      </a>
      {% else %}
      <img src="{{post.profile.image.url}}" class="rounded-full h-10"/>
      {% endif %}
      <p class="ml-4">{{post.profile|title}}</p>
      <p class="ml-4">{{post.date|timesince}} ago</p>

    </div>
    <p class="ml-16 mb-4">{{post.description}}</p>

  </div>
<hr/>
{% endfor %}




<h1 class="text-center text-3xl mt-40">Similar posts</h1>
  <div class="lg:grid grid-cols-3 gap-7 mx-6 mt-5 content-center">
    {% for post in posts %}
    <a href="{% url 'article-detail' post.slug%}">
    <div class="text-black font-semibold flex justify-between rounded-lg p-5">
      <div>
        <img class=" h-40 w-40	" src="{{post.image.url}}" />
      </div>
      <div class="pl-10">
        <h1>{{post.title}}</h1>
        <p>{{post.description|truncatechars:60|safe}}</p>
        <small>By: {{post.writer|title}}</small>
      </div>
  
    </div>
  
    </a>
    {% endfor %}
  </div>
  
</div>



<input type="hidden" id="refreshed" value="false">

  <script>
//     $(function() {
//     $("#friend_form").submit(function(event) {
//         // Stop form from submitting normally
//         event.preventDefault();
//         var friendForm = $(this);
//         // Send the data using post
//         var posting = $.post( friendForm.attr('action'), friendForm.serialize() );
//         // if success:
//         posting.done(function(data) {
//             // success actions, maybe change submit button to 'friend added' or whatever
//         });
//         // if failure:
//         posting.fail(function(data) {
//             // 4xx or 5xx response, alert user about failure
//         });
//     });
// });
    $(window).load(function(){
        if ($('#refreshed').val() == "false") {
          $('#refreshed').val("true"); 
        }
        else {
          $('#refreshed').val("false");
          location.reload();
        }
      });
    </script>
  
{% endblock content %}


